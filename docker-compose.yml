version: '3.8'

services:
  backend:
    build: ./Backend
    ports:
      - "5000:5000"
    environment:
      - FLASK_DEBUG=false
      - FLASK_HOST=0.0.0.0
      - FLASK_PORT=5000
      - FRONTEND_URL=http://localhost:3001
      - INITIAL_CASH=100000
      - ENABLE_PLOT=False
      - NVIDIA_VISIBLE_DEVICES=all
    volumes:
      - ./Backend:/app
      # Avoid using the host's venv inside the container
      - /app/venv
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]

  frontend:
    build: ./Frontend
    ports:
      - "3001:3000"
    environment:
      - REACT_APP_API_URL=http://localhost:5000
      # Prevent browser from opening automatically
      - BROWSER=none
    volumes:
      - ./Frontend:/app
      # Use the container's node_modules, not the host's
      - /app/node_modules
    depends_on:
      - backend
